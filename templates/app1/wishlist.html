{% load static %}
<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta charset="utf-8">
    <title>My Wishlist — Marketplace</title>

  

    <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate">
    <meta http-equiv="Pragma"        content="no-cache">
    <meta http-equiv="Expires"       content="0">
  

    <meta name="csrf-token" content="{{ csrf_token }}">
    
    <script>

      window.addEventListener('pageshow', function(event) {
        if (event.persisted) {
          window.location.reload();
        }
      });
  

      function getCookie(name) {
        let value = null;
        if (document.cookie && document.cookie !== '') {
          document.cookie.split(';').forEach(c => {
            const [k, v] = c.trim().split('=');
            if (k === name) value = decodeURIComponent(v);
          });
        }
        return value;
      }
  

      ;(function() {
        const realFetch = window.fetch;
        window.fetch = function(url, options = {}) {
          options.credentials = 'same-origin';
          options.headers     = options.headers || {};
          const method = (options.method || 'GET').toUpperCase();
          if (!['GET','HEAD','OPTIONS','TRACE'].includes(method)) {

            options.headers['X-CSRFToken'] = getCookie('csrftoken');
          }
          return realFetch(url, options);
        };
      })();
    </script>
    
  

  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet"
  >
  <link
    rel="stylesheet"
    href="{% static 'app1/css/custom.css' %}?v=2"
  >
  <style>

    .btn-modal,
    .btn-app {
      position: relative;
      z-index: 1050;
    }
  </style>
  
</head>
<body class="container py-4">
    {% include "app1/_navbar.html" %}
  
    <h2 class="mb-4">My Wishlist</h2>
  
    <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-4">
      {% for item in favorites %}
        <div class="col">
          <div class="card h-100">
            {% if item.images.first %}
              <div class="card-img-top" style="height:180px; overflow:hidden;">
                <img
                  src="{{ item.images.first.image.url }}"
                  alt="{{ item.title }}"
                  class="w-100 h-100"
                  style="object-fit:cover;"
                >
              </div>
            {% endif %}
            <div class="card-body d-flex flex-column">
              <h5 class="card-title">{{ item.title }}</h5>
              <p class="card-text text-truncate">{{ item.description }}</p>
              <div class="mt-auto">
                <a href="{% url 'detail' item.pk %}"
                  class="btn btn-primary btn-sm">
                  View
                </a>
              </div>
            </div>
          </div>
        </div>
      {% empty %}
        <div class="col-12">
          <p class="text-muted">Your wishlist is empty.</p>
        </div>
      {% endfor %}
    </div>
  
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </body>