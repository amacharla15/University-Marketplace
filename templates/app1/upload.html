{% load static %}
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- absolutely disable all HTTP + bfcache so you never re-use stale JS or tokens -->
<!-- in <head> -->
  <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate">
  <meta http-equiv="Pragma"        content="no-cache">
  <meta http-equiv="Expires"       content="0">
  <meta name="csrf-token" content="{{ csrf_token }}">
  
  <script>

  window.addEventListener('pageshow', e => { if (e.persisted) window.location.reload(); });
  

  function getCookie(name) {
    let v = null;
    document.cookie.split(';').forEach(c => {
      let [k,val]=c.trim().split('='); if (k===name) v=decodeURIComponent(val);
    });
    return v;
  }
  (() => {
    const _f = window.fetch;
    window.fetch = (url, opts={}) => {
      opts.credentials='same-origin';
      opts.headers=opts.headers||{};
      let m=(opts.method||'GET').toUpperCase();
      if (!['GET','HEAD','OPTIONS','TRACE'].includes(m)) {
        opts.headers['X-CSRFToken']=getCookie('csrftoken');
      }
      return _f(url,opts);
    };
  })();
  </script>
  
  <title>Create a New Listing â€” University Marketplace</title>
  <link 
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" 
    rel="stylesheet"
  >
</head>
<body class="container py-4">


  {% include "app1/_navbar.html" %}

  <h2>Create a New Listing</h2>

  <form method="post" enctype="multipart/form-data">
    {% csrf_token %}
  
    {# show any non-field errors #}
    {% if form.non_field_errors %}
      <div class="alert alert-danger">
        {{ form.non_field_errors }}
      </div>
    {% endif %}
  
    <!-- Title -->
    <div class="mb-3">
      <label for="{{ form.title.id_for_label }}" class="form-label">{{ form.title.label }}</label>
      {{ form.title }}
      {{ form.title.errors }}
    </div>
  

    <div class="mb-3">
      <label for="{{ form.description.id_for_label }}" class="form-label">{{ form.description.label }}</label>
      {{ form.description }}
      {{ form.description.errors }}
    </div>
  
    <!-- Price -->
    <div class="mb-3">
      <label for="{{ form.price.id_for_label }}" class="form-label">{{ form.price.label }}</label>
      <div class="input-group">
        <span class="input-group-text">$</span>
        {{ form.price }}
      </div>
      {{ form.price.errors }}
    </div>

    <div class="mb-3">
      {{ form.category.label_tag }}  
      {{ form.category }}
      {{ form.category.errors }}
    </div>

    <!-- Tags -->
    <div class="mb-3">
      {{ form.tags_str.label_tag }}  
      {{ form.tags_str }}
      {{ form.tags_str.errors }}
    </div>
  
    <!-- Images -->
    <div class="col-12">
      {{ form.images.label_tag }}
      {{ form.images }}   {# this will render your multi-file input #}
      {{ form.images.errors }}
      <small class="form-text text-muted">{{ form.images.help_text }}</small>
    </div>
  
    <button type="submit" class="btn btn-success">Post Listing</button>
  </form>
  

  <script 
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
  ></script>
</body>
</html>
