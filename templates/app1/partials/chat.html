{# templates/app1/partials/chat.html #}

<div id="chat-thread" style="max-height:300px; overflow-y:auto;">
  {% for msg in thread %}
    <div class="mb-2 p-2 rounded">
      <strong>{{ msg.sender.user.username }}:</strong>
      <small class="text-muted">{{ msg.timestamp|time:"H:i" }}</small><br>
      {{ msg.content|linebreaksbr }}
    </div>
  {% empty %}
    <p class="text-muted">No messages yet.</p>
  {% endfor %}
</div>

<form method="post"
      action="{% url 'chat_fragment' listing.pk %}?buyer={{ buyer.pk }}"
      class="ajax-form mt-2">
  {% csrf_token %}
  <input type="hidden" name="buyer" value="{{ buyer.pk }}">

  {% if reply_target %}
    <div class="alert alert-info py-1 px-2 mb-2 small">
      Replying to <strong>{{ reply_target.user.username }}</strong>
    </div>
  {% endif %}

  <div class="d-flex gap-1">
    {{ form.content }}
    <button type="submit" class="btn btn-sm btn-primary">Send</button>
  </div>
</form>
